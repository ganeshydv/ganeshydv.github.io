
# ğŸ” How Does a Video Player Read MP4?
### 1. Reads ftyp â†’ Confirms MP4 format.
### 2. Reads moov â†’ Extracts:
- Track info (trak) â†’ Finds video, audio, subtitle tracks.
- Sample tables (stbl) â†’ Finds where actual data is in mdat.
- Time scale (timescale) â†’ Determines playback speed.
### 3. Reads mdat â†’ Fetches frames from video/audio/subtitle tracks.
### 4. Decodes frames and renders them in sync.


## ğŸ“Œ Understanding Sample Tables (stbl)
### Inside moov â†’ trak â†’ mdia â†’ minf â†’ stbl, we have:
- Sample Description (stsd) â†’ Codec info (e.g., avc1 for H.264 video).
- Sample Size (stsz) â†’ Size of each frame/sample.
- Chunk Offset (stco or co64) â†’ File positions of media chunks.
- Time-to-Sample (stts) â†’ Playback timing.
### When a player needs the next frame, it:
- Looks at stsz to know frame size.
- Uses stco to locate mdat data.
- Refers to stts to sync audio/video.

## ğŸ“Œ How MP4 Knows Where Video, Audio & Subtitle Are?
#### 1. Multiple trak atoms in moov:

  - One trak for video (hdlr â†’ vide).
  - One trak for audio (hdlr â†’ soun).
  - One trak for subtitles (hdlr â†’ sbtl or subt).
#### 2. Each track has a sample table (stbl) that points to mdat positions.
#### 3. Player decodes & synchronizes tracks using stts (time mapping).

## ğŸ”¹ Real-World Example (MP4 Atom Layout)
```scss
[ftyp] (File Type)
[moov] (Movie Metadata)
  â”œâ”€â”€ [mvhd] (Movie Header)
  â”œâ”€â”€ [trak] (Video Track)
  â”‚    â”œâ”€â”€ [mdia] (Media)
  â”‚         â”œâ”€â”€ [minf] (Media Info)
  â”‚              â”œâ”€â”€ [stbl] (Sample Table)
  â”œâ”€â”€ [trak] (Audio Track)
  â”‚    â”œâ”€â”€ [mdia] (Media)
  â”‚         â”œâ”€â”€ [minf] (Media Info)
  â”‚              â”œâ”€â”€ [stbl] (Sample Table)
[mdat] (Media Data)
```
## ğŸ”¹ Optimizations for Streaming
### 1. Progressive MP4 (Fast Start):

- Moves moov to the beginning so players can start playback before downloading mdat.
### 2. Fragmented MP4 (fMP4):

- Splits video into multiple moof + mdat pairs, useful for adaptive streaming.

## Where 